<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fed ê¸ˆë¦¬ ì „ë§ ëŒ€ì‹œë³´ë“œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap');
:root{--bg:#06080f;--card:#0d1117;--border:#1b2332;--accent:#3b82f6;--green:#10b981;--red:#ef4444;--orange:#f59e0b;--purple:#8b5cf6;--cyan:#06b6d4;--pink:#ec4899;--text:#e2e8f0;--muted:#94a3b8;--dim:#475569}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.wrap{max-width:1100px;margin:0 auto;padding:20px 14px}

.hdr{text-align:center;padding:22px;margin-bottom:22px;background:linear-gradient(135deg,rgba(59,130,246,.07),rgba(139,92,246,.05));border:1px solid var(--border);border-radius:14px}
.hdr h1{font-size:21px;font-weight:900;background:linear-gradient(135deg,#60a5fa,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px}
.hdr .sub{font-size:12px;color:var(--muted);margin-bottom:8px}
.hdr .live{display:inline-flex;align-items:center;gap:5px;font-size:10px;color:var(--dim);background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.18);padding:3px 10px;border-radius:16px}
.hdr .live .dot{width:5px;height:5px;background:var(--green);border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

.metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:10px;margin-bottom:20px}
.mc{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;text-align:center}
.mc .ml{font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
.mc .mv{font-family:'JetBrains Mono',monospace;font-size:22px;font-weight:600}
.mc .ms{font-size:10px;color:var(--muted);margin-top:2px}

.sec{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:18px}
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:6px}
.st{font-size:14px;font-weight:700;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.badge{font-size:9px;padding:2px 7px;border-radius:8px;font-weight:500}
.b-nyfed{background:rgba(16,185,129,.12);color:#34d399}
.b-poly{background:rgba(59,130,246,.12);color:#60a5fa}
.b-kalshi{background:rgba(139,92,246,.12);color:#c4b5fd}
.b-free{background:rgba(245,158,11,.12);color:#fbbf24}
.sd{font-size:10px;color:var(--dim)}
.cw{position:relative;width:100%;height:280px}

/* Info box for SOFR explanation */
.info-box{background:rgba(6,182,212,.04);border:1px solid rgba(6,182,212,.15);border-radius:8px;padding:12px 14px;margin-top:12px;font-size:11px;color:var(--muted);line-height:1.7}
.info-box strong{color:var(--cyan);font-weight:600}
.info-box .ib-title{font-size:12px;font-weight:700;color:var(--text);margin-bottom:6px;display:flex;align-items:center;gap:5px}

.ft{width:100%;border-collapse:collapse;font-size:12px}
.ft th{text-align:left;padding:7px 8px;font-size:10px;color:var(--dim);border-bottom:1px solid var(--border);font-weight:500;text-transform:uppercase;letter-spacing:.4px}
.ft td{padding:9px 8px;border-bottom:1px solid rgba(27,35,50,.4);vertical-align:middle}
.ft tr:last-child td{border-bottom:none}
.pb{display:flex;align-items:center;gap:5px;height:20px}
.pb .bar{height:7px;border-radius:3px;min-width:2px}
.pb .pl{font-family:'JetBrains Mono',monospace;font-size:10px;min-width:32px;text-align:right}
.sb{font-size:9px;padding:2px 7px;border-radius:6px;font-weight:500;white-space:nowrap}
.s-done{background:rgba(16,185,129,.12);color:#34d399}
.s-next{background:rgba(245,158,11,.12);color:#fbbf24}
.s-future{background:rgba(100,116,139,.1);color:#94a3b8}
.s-nodata{background:rgba(100,116,139,.06);color:#64748b}

.pg{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
.pi{background:rgba(255,255,255,.015);border:1px solid var(--border);border-radius:9px;padding:13px}
.pi .pq{font-size:12px;color:var(--text);margin-bottom:9px;line-height:1.4;font-weight:500}
.pi .pa{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px}
.pi .pa .ol{font-size:11px}
.pi .pa .op{font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:600}
.pi .bt{width:100%;height:5px;background:rgba(255,255,255,.04);border-radius:3px;margin-bottom:3px;overflow:hidden}
.pi .bf{height:100%;border-radius:3px}
.src{display:flex;gap:4px;margin-top:6px}
.src span{font-size:9px;padding:1px 5px;border-radius:3px;font-weight:500}
.tp{background:#1d4ed8;color:#93c5fd}
.tk{background:#5b21b6;color:#c4b5fd}

.leg{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px;justify-content:center}
.leg-i{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--muted)}
.leg-d{width:9px;height:9px;border-radius:50%}

.no-data{text-align:center;padding:40px 20px;color:var(--dim);font-size:12px;line-height:1.8}
.foot{text-align:center;font-size:9px;color:var(--dim);margin-top:18px;padding:10px;border-top:1px solid var(--border);line-height:1.5}

@media(max-width:768px){.cw{height:230px}.mc .mv{font-size:18px}.hdr h1{font-size:17px}}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <h1>ğŸ¦ Fed ê¸ˆë¦¬ ì „ë§ ëŒ€ì‹œë³´ë“œ</h1>
    <div class="sub">SOFR Â· Polymarket Â· Kalshi ì˜ˆì¸¡ ì‹œì¥ | ë¬´ë£Œ API ìë™ ì—…ë°ì´íŠ¸</div>
    <div class="live"><span class="dot"></span><span id="ts">ë¡œë”© ì¤‘...</span></div>
  </div>

  <div class="metrics">
    <div class="mc"><div class="ml">í˜„ì¬ SOFR</div><div class="mv" style="color:var(--cyan)" id="m-sofr">--</div><div class="ms" id="m-sofr-d">--</div></div>
    <div class="mc"><div class="ml">Fed Funds ëª©í‘œ</div><div class="mv" style="color:var(--accent)" id="m-ff">4.25-4.50%</div><div class="ms" id="m-ff-d">--</div></div>
    <div class="mc"><div class="ml">ì—°ë§ ì˜ˆìƒ (ìµœë‹¤)</div><div class="mv" style="color:var(--purple)" id="m-ye">--</div><div class="ms" id="m-ye-d">--</div></div>
    <div class="mc"><div class="ml">ë‹¤ìŒ FOMC</div><div class="mv" style="color:var(--orange)" id="m-next">--</div><div class="ms" id="m-next-d">--</div></div>
  </div>

  <!-- SOFR -->
  <div class="sec">
    <div class="sh"><div><div class="st">ğŸ“ˆ SOFR ê¸ˆë¦¬ ì¶”ì´ <span class="badge b-nyfed">NY Fed</span><span class="badge b-free">ë¬´ë£Œ</span></div><div class="sd">ë‰´ìš• ì—°ì¤€ ë°œí‘œ Secured Overnight Financing Rate</div></div></div>
    <div id="sofrWrap"><div class="cw"><canvas id="cSOFR"></canvas></div></div>
    <div class="info-box">
      <div class="ib-title">ğŸ’¡ SOFRì´ë€?</div>
      <strong>SOFR</strong>(Secured Overnight Financing Rate)ì€ ë¯¸êµ­ êµ­ì±„ë¥¼ ë‹´ë³´ë¡œ í•œ í•˜ë£¨ì§œë¦¬ ëŒ€ì¶œ ê¸ˆë¦¬ì…ë‹ˆë‹¤.
      ë‰´ìš• ì—°ì¤€ì´ ë§¤ì¼ ë°œí‘œí•˜ë©°, <strong>Fed ê¸°ì¤€ê¸ˆë¦¬(FFR)ì˜ ì‹¤ì œ ì‹œì¥ ë°˜ì˜ì¹˜</strong>ë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
      â€¢ <strong>SOFR â‰ˆ Fed Funds Rate í•˜í•œ</strong> â€” í˜„ì¬ ëª©í‘œ ë²”ìœ„ 4.25~4.50% ì¤‘ í•˜í•œ(4.25%)ì— ê·¼ì ‘í•˜ê²Œ ê±°ë˜ë©ë‹ˆë‹¤.<br>
      â€¢ SOFRì´ ê°‘ìê¸° ê¸‰ë“±í•˜ë©´ ë‹¨ê¸° ìê¸ˆ ì‹œì¥ì— ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ìˆë‹¤ëŠ” ì‹ í˜¸ì…ë‹ˆë‹¤ (ì˜ˆ: ë¶„ê¸°ë§, ì—°ë§ íš¨ê³¼).<br>
      â€¢ 2023ë…„ë¶€í„° LIBORë¥¼ ëŒ€ì²´í•˜ì—¬ ë¯¸êµ­ ê¸ˆìœµì‹œì¥ì˜ <strong>í•µì‹¬ ê¸°ì¤€ê¸ˆë¦¬</strong>ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- FOMC -->
  <div class="sec">
    <div class="sh"><div><div class="st">ğŸ¯ FOMC ë¯¸íŒ…ë³„ ê¸ˆë¦¬ ì „ë§ <span class="badge b-poly">Polymarket</span><span class="badge b-kalshi">Kalshi</span></div><div class="sd">FOMC ê³µì‹ ì¼ì • ê¸°ë°˜ + ì˜ˆì¸¡ ì‹œì¥ í™•ë¥  ë§¤í•‘</div></div></div>
    <div id="fomcWrap"><div class="cw" style="height:300px"><canvas id="cFOMC"></canvas></div>
    <div class="leg">
      <div class="leg-i"><div class="leg-d" style="background:var(--dim)"></div>ë™ê²°</div>
      <div class="leg-i"><div class="leg-d" style="background:var(--accent)"></div>25bp ì¸í•˜</div>
      <div class="leg-i"><div class="leg-d" style="background:var(--cyan)"></div>50bp+ ì¸í•˜</div>
      <div class="leg-i"><div class="leg-d" style="background:var(--red)"></div>ì¸ìƒ</div>
    </div></div>
  </div>

  <!-- Rate Path -->
  <div class="sec">
    <div class="sh"><div><div class="st">ğŸ“‰ ì˜ˆìƒ ê¸ˆë¦¬ ê²½ë¡œ <span class="badge b-poly">Polymarket</span><span class="badge b-kalshi">Kalshi</span></div><div class="sd">ì˜ˆì¸¡ ì‹œì¥ í™•ë¥ ì—ì„œ ê³„ì‚°í•œ ë‚´ì¬ ê¸ˆë¦¬ ê²½ë¡œ</div></div></div>
    <div id="pathWrap"><div class="cw"><canvas id="cPath"></canvas></div></div>
    <div class="info-box">
      <div class="ib-title">ğŸ“ ê³„ì‚° ë°©ë²•</div>
      ê° FOMC ë¯¸íŒ…ì˜ ì˜ˆìƒ ê¸ˆë¦¬ ë³€ë™ = (ì¸í•˜25bp í™•ë¥  Ã— -0.25) + (ì¸í•˜50bp í™•ë¥  Ã— -0.50) + (ì¸ìƒ í™•ë¥  Ã— +0.25)<br>
      ì´ë¥¼ í˜„ì¬ ê¸ˆë¦¬ì—ì„œ ëˆ„ì í•˜ì—¬ í–¥í›„ ê¸ˆë¦¬ ê²½ë¡œë¥¼ ì¶”ì •í•©ë‹ˆë‹¤. ì˜ˆì¸¡ ì‹œì¥ ë°ì´í„°ê°€ ì—†ëŠ” ë¯¸íŒ…ì€ ë™ê²°ë¡œ ê°€ì •í•©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- FOMC Table -->
  <div class="sec">
    <div class="sh"><div><div class="st">ğŸ“‹ FOMC ë¯¸íŒ… ì„¸ë¶€ í™•ë¥ </div><div class="sd">ì—°ì¤€ ê³µì‹ ì¼ì • ê¸°ë°˜</div></div></div>
    <div style="overflow-x:auto"><table class="ft"><thead><tr><th>ë¯¸íŒ…</th><th>ë‚ ì§œ</th><th>ìƒíƒœ</th><th>ë™ê²°</th><th>25bp ì¸í•˜</th><th>50bp+ ì¸í•˜</th><th>ì¸ìƒ</th></tr></thead><tbody id="tBody"></tbody></table></div>
  </div>

  <!-- Prediction Grid -->
  <div class="sec">
    <div class="sh"><div><div class="st">ğŸ”® ì£¼ìš” ê¸ˆë¦¬ ì˜ˆì¸¡ ë§ˆì¼“</div><div class="sd">Polymarket & Kalshi Fed ê´€ë ¨ í™œì„± ë§ˆì¼“</div></div></div>
    <div class="pg" id="pGrid"></div>
  </div>

  <div class="foot">
    âš ï¸ ë³¸ ëŒ€ì‹œë³´ë“œëŠ” ì •ë³´ ì œê³µ ëª©ì ì´ë©°, íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹™ë‹ˆë‹¤.<br>
    ë°ì´í„°: NY Fed Markets API Â· Polymarket Gamma API Â· Kalshi Public API Â· ì—°ì¤€ FOMC ìº˜ë¦°ë” (ëª¨ë‘ ë¬´ë£Œ)
  </div>
</div>

<script>
const MONTH_KO={1:"1ì›”",2:"2ì›”",3:"3ì›”",4:"4ì›”",5:"5ì›”",6:"6ì›”",7:"7ì›”",8:"8ì›”",9:"9ì›”",10:"10ì›”",11:"11ì›”",12:"12ì›”"};
const MONTH_EN_KO={january:"1ì›”",february:"2ì›”",march:"3ì›”",april:"4ì›”",may:"5ì›”",june:"6ì›”",july:"7ì›”",august:"8ì›”",september:"9ì›”",october:"10ì›”",november:"11ì›”",december:"12ì›”"};

function toKo(s){
  if(!s)return s;let t=s;
  t=t.replace(/will no rate cuts? happen in (\d{4})\??/gi,(_,y)=>`${y}ë…„ ê¸ˆë¦¬ ì¸í•˜ 0íšŒ ì—¬ë¶€`);
  t=t.replace(/will (\d+) or more rate cuts? happen in (\d{4})\??/gi,(_,n,y)=>`${y}ë…„ ${n}íšŒ ì´ìƒ ê¸ˆë¦¬ ì¸í•˜ ì—¬ë¶€`);
  t=t.replace(/will fewer than (\d+) rate cuts? happen in (\d{4})\??/gi,(_,n,y)=>`${y}ë…„ ${n}íšŒ ë¯¸ë§Œ ê¸ˆë¦¬ ì¸í•˜ ì—¬ë¶€`);
  t=t.replace(/will at least (\d+) rate cuts? happen in (\d{4})\??/gi,(_,n,y)=>`${y}ë…„ ìµœì†Œ ${n}íšŒ ê¸ˆë¦¬ ì¸í•˜ ì—¬ë¶€`);
  t=t.replace(/will (\d+) rate cuts? happen in (\d{4})\??/gi,(_,n,y)=>`${y}ë…„ ${n}íšŒ ê¸ˆë¦¬ ì¸í•˜ ì—¬ë¶€`);
  t=t.replace(/how many (?:fed )?rate cuts? (?:in )?(\d{4})\??/gi,(_,y)=>`${y}ë…„ Fed ê¸ˆë¦¬ ì¸í•˜ íšŸìˆ˜`);
  t=t.replace(/number of (?:fed )?rate cuts?.*?(\d{4})/gi,(_,y)=>`${y}ë…„ ê¸ˆë¦¬ ì¸í•˜ íšŸìˆ˜`);
  for(const[en,ko]of Object.entries(MONTH_EN_KO)){t=t.replace(new RegExp(`Fed [Dd]ecision in ${en}\\??`,"gi"),`${ko} FOMC ê¸ˆë¦¬ ê²°ì •`);}
  t=t.replace(/what will the fed (?:funds )?rate be at the end of (\d{4})\??/gi,(_,y)=>`${y}ë…„ ë§ Fed ê¸°ì¤€ê¸ˆë¦¬ ì „ë§`);
  t=t.replace(/fed funds rate (?:at )?(?:the )?end of (\d{4})/gi,(_,y)=>`${y}ë…„ ë§ ê¸°ì¤€ê¸ˆë¦¬`);
  t=t.replace(/will the fed (?:raise|hike) rates?.*?(\d{4})\??/gi,(_,y)=>`${y}ë…„ Fed ê¸ˆë¦¬ ì¸ìƒ ì—¬ë¶€`);
  t=t.replace(/will the fed cut rates?.*?(\d{4})\??/gi,(_,y)=>`${y}ë…„ Fed ê¸ˆë¦¬ ì¸í•˜ ì—¬ë¶€`);
  return t;
}
function outcomeKo(o){
  const map={"Yes":"ì˜ˆ","No":"ì•„ë‹ˆì˜¤","No change":"ë™ê²°","25 bps decrease":"25bp ì¸í•˜","25 bps cut":"25bp ì¸í•˜","50 bps decrease":"50bp ì¸í•˜","50 bps cut":"50bp ì¸í•˜","75 bps decrease":"75bp ì¸í•˜","100 bps decrease":"100bp ì¸í•˜","25 bps increase":"25bp ì¸ìƒ","50 bps increase":"50bp ì¸ìƒ","Increase":"ì¸ìƒ","Decrease":"ì¸í•˜"};
  if(map[o])return map[o];let m;
  if(m=o.match(/(\d+)\s*bps?\s*(decrease|cut)/i))return`${m[1]}bp ì¸í•˜`;
  if(m=o.match(/(\d+)\s*bps?\s*(increase|hike)/i))return`${m[1]}bp ì¸ìƒ`;
  if(m=o.match(/(\d+\.\d+)\s*[-â€“]\s*(\d+\.\d+)/))return`${m[1]}~${m[2]}%`;
  if(m=o.match(/(\d+)\s*cuts?/i))return`${m[1]}íšŒ ì¸í•˜`;
  if(m=o.match(/(\d+)\s*or more/i))return`${m[1]}íšŒ ì´ìƒ`;
  return o;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Data Load
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function loadData(){
  try{const r=await fetch("data/rate_data.json");if(r.ok){const j=await r.json();if(j.sofr?.length||j.fomc_calendar?.length)return j;}}catch(_){}
  return await fetchLive();
}

async function fetchLive(){
  const out={meta:{updated_at:new Date().toISOString()},sofr:[],fomc_calendar:[],polymarket:{fomc_decisions:[],other_markets:[]},kalshi:[]};
  try{
    const r=await fetch("https://markets.newyorkfed.org/api/rates/secured/sofr/last/60.json");
    const j=await r.json();
    out.sofr=(j.refRates||[]).map(x=>({date:x.effectiveDate,rate:+x.percentRate})).sort((a,b)=>a.date.localeCompare(b.date));
  }catch(e){console.warn("SOFR fail",e);}
  // Polymarket live fetch omitted for brevity â€” JSON file is primary source
  return out;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  â˜… FOMC ìº˜ë¦°ë” + Polymarket ë°ì´í„° ë³‘í•©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function buildFOMCMeetings(calendar, polyFomc){
  const now=new Date();
  const thisYear=now.getFullYear();

  // 1) Polymarket ì´ë²¤íŠ¸ë¥¼ ì›” ê¸°ì¤€ìœ¼ë¡œ ì¸ë±ì‹± (ì˜¬í•´ ê²ƒë§Œ)
  const polyByMonth={}; // "2026-3" â†’ event
  for(const ev of polyFomc){
    const title=ev.title.toLowerCase();
    let matchMonth=null;
    for(const[en,ko]of Object.entries(MONTH_EN_KO)){
      if(title.includes(en)){matchMonth=en;break;}
    }
    if(!matchMonth)continue;
    const monthNum=Object.keys(MONTH_EN_KO).indexOf(matchMonth)+1;

    // endDateì—ì„œ ì—°ë„ ì¶”ì¶œ
    let evYear=thisYear;
    if(ev.endDate){
      try{evYear=new Date(ev.endDate).getFullYear();}catch(_){}
    }

    const key=`${evYear}-${monthNum}`;
    if(!polyByMonth[key])polyByMonth[key]=ev;
  }

  // 2) ìº˜ë¦°ë”ì˜ ê° ë¯¸íŒ…ì— Polymarket ë°ì´í„° ë§¤í•‘
  const meetings=[];
  for(const cal of calendar){
    const key=`${cal.year}-${cal.month}`;
    const polyEv=polyByMonth[key]||null;
    const dateStr=cal.date;
    const endDateStr=`${cal.year}-${String(cal.month).padStart(2,'0')}-${String(cal.end_day).padStart(2,'0')}`;
    const meetingEnd=new Date(endDateStr+"T23:59:59Z");
    const isPast=meetingEnd<now;

    let noChange=0,cut25=0,cut50=0,hike=0,hasData=false;

    if(polyEv){
      hasData=true;
      for(const m of polyEv.markets){
        const outs=m.outcomes_en||m.outcomes||[];
        outs.forEach((o,i)=>{
          const ol=o.toLowerCase(),pi=(m.prices[i]||0)*100;
          if(ol.includes("no change")||ol==="ë™ê²°") noChange=Math.max(noChange,pi);
          else if((ol.includes("25")&&(ol.includes("decrease")||ol.includes("cut")))||ol==="25bp ì¸í•˜") cut25=Math.max(cut25,pi);
          else if((ol.includes("50")&&(ol.includes("decrease")||ol.includes("cut")))||ol==="50bp ì¸í•˜") cut50=Math.max(cut50,pi);
          else if(ol.includes("hike")||ol.includes("increase")||ol==="ì¸ìƒ") hike=Math.max(hike,pi);
        });
        // binary
        const q=(m.question+" "+m.groupItemTitle).toLowerCase();
        if(outs.length<=2){
          const p0=(m.prices[0]||0)*100;
          if(q.includes("no change"))noChange=Math.max(noChange,p0);
          else if(q.includes("25")&&(q.includes("decrease")||q.includes("cut")))cut25=Math.max(cut25,p0);
          else if(q.includes("50")&&(q.includes("decrease")||q.includes("cut")))cut50=Math.max(cut50,p0);
          else if(q.includes("increase")||q.includes("hike"))hike=Math.max(hike,p0);
        }
      }
    }

    // ë¼ë²¨: "3ì›”" (ê°™ì€ í•´) ë˜ëŠ” "3ì›” '27" (ë‹¤ë¥¸ í•´)
    let label=MONTH_KO[cal.month];
    if(cal.year!==thisYear) label+=` '${String(cal.year).slice(2)}`;

    meetings.push({
      title: label,
      dateLabel: `${cal.month}/${cal.date.split('-')[2]}-${cal.end_day}`,
      date: cal.date,
      year: cal.year,
      month: cal.month,
      noChange: Math.round(noChange),
      cut25: Math.round(cut25),
      cut50: Math.round(cut50),
      hike: Math.round(hike),
      hasData,
      isPast,
    });
  }

  // ì˜¬í•´ ë¯¸íŒ…ë§Œ + ë‹¤ìŒí•´ ì²« 2ê°œ
  const thisYearMeetings=meetings.filter(m=>m.year===thisYear);
  const nextYearMeetings=meetings.filter(m=>m.year===thisYear+1).slice(0,2);
  const filtered=[...thisYearMeetings,...nextYearMeetings];

  // ìƒíƒœ ê²°ì •
  const futureIdx=filtered.findIndex(m=>!m.isPast);
  filtered.forEach((m,i)=>{
    if(m.isPast)m.status="done";
    else if(i===futureIdx)m.status="next";
    else m.status="future";
  });

  return filtered;
}

function parseOtherMarkets(polyOther,kalshi){
  const items=[];
  for(const ev of polyOther){
    for(const m of ev.markets){
      if(!m.prices.length)continue;
      const outs=m.outcomes_en||m.outcomes||[];
      items.push({question:toKo(m.question_en||m.question||ev.title),outcomes:outs.map((o,i)=>({label:outcomeKo(o),pct:Math.round((m.prices[i]||0)*100)})),source:"polymarket",volume:m.volume});
    }
  }
  for(const series of(kalshi||[])){
    for(const m of series.markets){
      const yesP=m.last_price||m.yes_bid||0;if(!yesP)continue;
      items.push({question:toKo(m.title||"")+(m.subtitle?" â€” "+toKo(m.subtitle):""),outcomes:[{label:"ì˜ˆ",pct:yesP},{label:"ì•„ë‹ˆì˜¤",pct:100-yesP}],source:"kalshi",volume:m.volume||0});
    }
  }
  items.sort((a,b)=>(b.volume||0)-(a.volume||0));
  return items.slice(0,8);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Charts
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Chart.defaults.color='#94a3b8';Chart.defaults.borderColor='#1a2332';
Chart.defaults.font.family="'Noto Sans KR','JetBrains Mono',sans-serif";Chart.defaults.font.size=11;
const charts={};

function drawSOFR(sofr){
  if(!sofr.length)return;
  const ctx=document.getElementById("cSOFR").getContext("2d");
  if(charts.sofr)charts.sofr.destroy();
  charts.sofr=new Chart(ctx,{type:"line",
    data:{labels:sofr.map(d=>{const t=new Date(d.date);return`${t.getMonth()+1}/${t.getDate()}`}),
      datasets:[{label:"SOFR (%)",data:sofr.map(d=>d.rate),borderColor:"#06b6d4",backgroundColor:"rgba(6,182,212,.08)",borderWidth:2,fill:true,tension:.3,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:"#06b6d4"}]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:"index",intersect:false},
      plugins:{legend:{display:false},tooltip:{backgroundColor:"#1e293b",borderColor:"#334155",borderWidth:1,padding:8,callbacks:{label:c=>`SOFR: ${c.raw.toFixed(3)}%`}}},
      scales:{x:{grid:{display:false},ticks:{maxTicksLimit:8,font:{size:10}}},y:{grid:{color:"#1a2332"},ticks:{callback:v=>v.toFixed(2)+"%",font:{size:10}}}}}
  });
}

function drawFOMC(fomc){
  if(!fomc.length)return;
  const ctx=document.getElementById("cFOMC").getContext("2d");
  if(charts.fomc)charts.fomc.destroy();
  // ë¯¸ë˜ ë¯¸íŒ…ë§Œ ì°¨íŠ¸ì— (ê³¼ê±°ëŠ” í…Œì´ë¸”ì—ì„œë§Œ)
  const future=fomc.filter(f=>!f.isPast);
  if(!future.length)return;
  charts.fomc=new Chart(ctx,{type:"bar",
    data:{labels:future.map(f=>f.title+(f.hasData?"":"\n(ë°ì´í„° ì—†ìŒ)")),
      datasets:[
        {label:"ë™ê²°",data:future.map(f=>f.noChange),backgroundColor:future.map(f=>f.hasData?"#475569":"#2a3040"),borderRadius:3,barPercentage:.7},
        {label:"25bp ì¸í•˜",data:future.map(f=>f.cut25),backgroundColor:future.map(f=>f.hasData?"#3b82f6":"#1e3a5f"),borderRadius:3,barPercentage:.7},
        {label:"50bp+ ì¸í•˜",data:future.map(f=>f.cut50),backgroundColor:future.map(f=>f.hasData?"#06b6d4":"#0a4a54"),borderRadius:3,barPercentage:.7},
        {label:"ì¸ìƒ",data:future.map(f=>f.hike),backgroundColor:future.map(f=>f.hasData?"#ef4444":"#5a2020"),borderRadius:3,barPercentage:.7},
      ]},
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{backgroundColor:"#1e293b",borderColor:"#334155",borderWidth:1,padding:8,callbacks:{label:c=>c.raw?`${c.dataset.label}: ${c.raw}%`:''}}},
      scales:{x:{stacked:true,grid:{display:false},ticks:{font:{size:10}}},y:{stacked:true,max:100,grid:{color:"#1a2332"},ticks:{callback:v=>v+"%",font:{size:10}}}}}
  });
}

function drawPath(fomc){
  const future=fomc.filter(f=>!f.isPast);
  if(!future.length)return;
  let upper=4.50;
  const path=[{label:"í˜„ì¬",upper,lower:upper-0.25}];
  for(const f of future){
    // ë°ì´í„° ì—†ìœ¼ë©´ ë™ê²° ê°€ì • (ë³€í™” 0)
    const exp=f.hasData?(f.cut25*-0.25+f.cut50*-0.50+f.hike*0.25)/100:0;
    upper=Math.round((upper+exp)*100)/100;
    path.push({label:f.title,upper,lower:upper-0.25});
  }
  const ctx=document.getElementById("cPath").getContext("2d");
  if(charts.path)charts.path.destroy();
  charts.path=new Chart(ctx,{type:"line",
    data:{labels:path.map(p=>p.label),
      datasets:[
        {label:"ë‚´ì¬ ê¸ˆë¦¬ ìƒí•œ",data:path.map(p=>p.upper),borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,.06)",borderWidth:2.5,fill:true,tension:.4,pointRadius:5,pointBackgroundColor:"#3b82f6",pointBorderColor:"#0d1117",pointBorderWidth:2},
        {label:"ë‚´ì¬ ê¸ˆë¦¬ í•˜í•œ",data:path.map(p=>p.lower),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,.06)",borderWidth:2,borderDash:[5,5],fill:true,tension:.4,pointRadius:4,pointBackgroundColor:"#8b5cf6",pointBorderColor:"#0d1117",pointBorderWidth:2},
      ]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:"index",intersect:false},
      plugins:{legend:{position:"bottom",labels:{boxWidth:10,padding:14,font:{size:10},usePointStyle:true}},tooltip:{backgroundColor:"#1e293b",borderColor:"#334155",borderWidth:1,padding:8,callbacks:{label:c=>`${c.dataset.label}: ${c.raw.toFixed(2)}%`}}},
      scales:{x:{grid:{display:false},ticks:{font:{size:10}}},y:{grid:{color:"#1a2332"},ticks:{callback:v=>v.toFixed(2)+"%",stepSize:.25,font:{size:10}},suggestedMin:2.5}}}
  });
}

function drawTable(fomc){
  const tb=document.getElementById("tBody");
  if(!fomc.length){tb.innerHTML='<tr><td colspan="7" style="text-align:center;color:var(--dim);padding:20px">ë°ì´í„° ì—†ìŒ</td></tr>';return;}
  tb.innerHTML=fomc.map(f=>{
    const sc=f.status==="done"?"s-done":f.status==="next"?"s-next":"s-future";
    const sl=f.status==="done"?"ì™„ë£Œ":f.status==="next"?"ë‹¤ìŒ":"ì˜ˆì •";
    if(!f.hasData&&!f.isPast){
      return`<tr style="opacity:.5"><td style="font-weight:500">${f.title}</td><td>${f.dateLabel}</td><td><span class="sb s-nodata">${sl}</span></td><td colspan="4" style="text-align:center;color:var(--dim);font-size:11px">ì˜ˆì¸¡ ë°ì´í„° ì—†ìŒ</td></tr>`;
    }
    const bar=(p,c)=>`<div class="pb"><div class="bar" style="width:${Math.max(p,1)}%;background:${c}"></div><span class="pl" style="color:${c}">${p}%</span></div>`;
    return`<tr><td style="font-weight:500">${f.title}</td><td style="font-size:11px;color:var(--dim)">${f.dateLabel}</td><td><span class="sb ${sc}">${sl}</span></td><td>${bar(f.noChange,"#64748b")}</td><td>${bar(f.cut25,"#3b82f6")}</td><td>${bar(f.cut50,"#06b6d4")}</td><td>${bar(f.hike,"#ef4444")}</td></tr>`;
  }).join("");
}

function drawPredGrid(items){
  const g=document.getElementById("pGrid");
  if(!items.length){g.innerHTML='<div class="no-data" style="grid-column:1/-1">ğŸ“­ Fed ê´€ë ¨ ì˜ˆì¸¡ ë§ˆì¼“ì´ ì—†ìŠµë‹ˆë‹¤</div>';return;}
  const colors=["var(--accent)","var(--purple)","var(--cyan)","var(--orange)","var(--green)","var(--pink)"];
  g.innerHTML=items.map(item=>{
    const srcTag=item.source==="polymarket"?'<span class="tp">Polymarket</span>':'<span class="tk">Kalshi</span>';
    return`<div class="pi"><div class="pq">${item.question}</div>${item.outcomes.slice(0,4).map((o,i)=>`<div class="pa"><span class="ol">${o.label}</span><span class="op" style="color:${colors[i%colors.length]}">${o.pct}%</span></div><div class="bt"><div class="bf" style="width:${o.pct}%;background:${colors[i%colors.length]}"></div></div>`).join("")}<div class="src">${srcTag}</div></div>`;
  }).join("");
}

function updateMetrics(sofr,fomc,otherMarkets,data){
  if(sofr.length){
    const last=sofr[sofr.length-1];
    document.getElementById("m-sofr").textContent=last.rate.toFixed(2)+"%";
    document.getElementById("m-sofr-d").textContent=last.date;
  }
  const yearEnd=otherMarkets.find(m=>m.question.includes("ë§")||m.question.toLowerCase().includes("end of"));
  if(yearEnd&&yearEnd.outcomes.length){
    const top=yearEnd.outcomes.reduce((a,b)=>b.pct>a.pct?b:a,yearEnd.outcomes[0]);
    document.getElementById("m-ye").textContent=top.label;
    document.getElementById("m-ye-d").textContent=`${top.pct}% í™•ë¥ `;
  }
  // â˜… ë‹¤ìŒ FOMC â€” ìº˜ë¦°ë” ê¸°ë°˜ìœ¼ë¡œ ì •í™•íˆ í‘œì‹œ
  const next=fomc.find(f=>f.status==="next");
  if(next){
    if(next.hasData){
      const topAction=next.noChange>=Math.max(next.cut25,next.cut50)?"ë™ê²°":"ì¸í•˜";
      const topPct=Math.max(next.noChange,next.cut25,next.cut50);
      document.getElementById("m-next").textContent=topAction+" "+topPct+"%";
    } else {
      document.getElementById("m-next").textContent=next.title;
    }
    document.getElementById("m-next-d").textContent=next.dateLabel;
  }
  const ts=data.meta?.updated_at||new Date().toISOString();
  const d=new Date(ts);
  document.getElementById("ts").textContent=`${d.toLocaleDateString("ko-KR")} ${d.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})} ì—…ë°ì´íŠ¸`;
}

async function init(){
  try{
    const data=await loadData();
    const sofr=data.sofr||[];
    const calendar=data.fomc_calendar||[];
    const fomc=buildFOMCMeetings(calendar,data.polymarket?.fomc_decisions||[]);
    const otherMarkets=parseOtherMarkets(data.polymarket?.other_markets||[],data.kalshi||[]);
    updateMetrics(sofr,fomc,otherMarkets,data);
    drawSOFR(sofr);drawFOMC(fomc);drawPath(fomc);drawTable(fomc);drawPredGrid(otherMarkets);
  }catch(e){console.error(e);document.getElementById("ts").textContent="ë¡œë“œ ì‹¤íŒ¨: "+e.message;}
}
init();
</script>
</body>
</html>
