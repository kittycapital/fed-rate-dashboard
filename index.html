<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fed ê¸ˆë¦¬ ì „ë§ ëŒ€ì‹œë³´ë“œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap');
:root{--bg:#06080f;--card:#0d1117;--border:#1b2332;--accent:#3b82f6;--green:#10b981;--red:#ef4444;--orange:#f59e0b;--purple:#8b5cf6;--cyan:#06b6d4;--pink:#ec4899;--text:#e2e8f0;--muted:#94a3b8;--dim:#475569}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--text);min-height:100vh}
.wrap{max-width:1100px;margin:0 auto;padding:20px 14px}
.hdr{text-align:center;padding:22px;margin-bottom:22px;background:linear-gradient(135deg,rgba(59,130,246,.07),rgba(139,92,246,.05));border:1px solid var(--border);border-radius:14px}
.hdr h1{font-size:21px;font-weight:900;background:linear-gradient(135deg,#60a5fa,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px}
.hdr .sub{font-size:12px;color:var(--muted);margin-bottom:8px}
.hdr .live{display:inline-flex;align-items:center;gap:5px;font-size:10px;color:var(--dim);background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.18);padding:3px 10px;border-radius:16px}
.hdr .live .dot{width:5px;height:5px;background:var(--green);border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

.metrics{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:20px}
@media(max-width:600px){.metrics{grid-template-columns:repeat(2,1fr)}}
.mc{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;text-align:center}
.mc .ml{font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:5px}
.mc .mv{font-family:'JetBrains Mono',monospace;font-size:20px;font-weight:600}
.mc .ms{font-size:10px;color:var(--muted);margin-top:2px}

.sec{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:18px;margin-bottom:18px}
.sh{margin-bottom:14px}
.st{font-size:14px;font-weight:700;display:flex;align-items:center;gap:7px;flex-wrap:wrap}
.badge{font-size:9px;padding:2px 7px;border-radius:8px;font-weight:500}
.b-nyfed{background:rgba(16,185,129,.12);color:#34d399}
.b-poly{background:rgba(59,130,246,.12);color:#60a5fa}
.b-fred{background:rgba(245,158,11,.12);color:#fbbf24}
.b-free{background:rgba(100,116,139,.12);color:#94a3b8}
.sd{font-size:10px;color:var(--dim);margin-top:3px}
.cw{position:relative;width:100%;height:280px}

.info{background:rgba(6,182,212,.04);border:1px solid rgba(6,182,212,.12);border-radius:8px;padding:12px 14px;margin-top:14px;font-size:11px;color:var(--muted);line-height:1.7}
.info b{color:var(--cyan);font-weight:600}
.info .it{font-size:12px;font-weight:700;color:var(--text);margin-bottom:5px}

.ft{width:100%;border-collapse:collapse;font-size:12px}
.ft th{text-align:left;padding:7px 8px;font-size:10px;color:var(--dim);border-bottom:1px solid var(--border);font-weight:500;text-transform:uppercase;letter-spacing:.4px}
.ft td{padding:9px 8px;border-bottom:1px solid rgba(27,35,50,.4);vertical-align:middle}
.ft tr:last-child td{border-bottom:none}
.pb{display:flex;align-items:center;gap:5px;height:20px}
.pb .bar{height:7px;border-radius:3px;min-width:2px}
.pb .pl{font-family:'JetBrains Mono',monospace;font-size:10px;min-width:32px;text-align:right}
.sb{font-size:9px;padding:2px 7px;border-radius:6px;font-weight:500;white-space:nowrap}
.s-done{background:rgba(16,185,129,.12);color:#34d399}
.s-next{background:rgba(245,158,11,.12);color:#fbbf24}
.s-future{background:rgba(100,116,139,.1);color:#94a3b8}

.leg{display:flex;flex-wrap:wrap;gap:12px;margin-top:10px;justify-content:center}
.leg-i{display:flex;align-items:center;gap:4px;font-size:10px;color:var(--muted)}
.leg-d{width:9px;height:9px;border-radius:50%}
.nd{text-align:center;padding:30px;color:var(--dim);font-size:12px}
.foot{text-align:center;font-size:9px;color:var(--dim);margin-top:18px;padding:10px;border-top:1px solid var(--border);line-height:1.5}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <h1>ğŸ¦ Fed ê¸ˆë¦¬ ì „ë§ ëŒ€ì‹œë³´ë“œ</h1>
    <div class="sub">SOFR Â· FRED Â· Polymarket ì˜ˆì¸¡ ì‹œì¥ | ë¬´ë£Œ API ìë™ ì—…ë°ì´íŠ¸</div>
    <div class="live"><span class="dot"></span><span id="ts">ë¡œë”© ì¤‘...</span></div>
  </div>

  <!-- 4 Metrics -->
  <div class="metrics">
    <div class="mc"><div class="ml">í˜„ì¬ SOFR</div><div class="mv" style="color:var(--cyan)" id="m-sofr">--</div><div class="ms" id="m-sofr-d">--</div></div>
    <div class="mc"><div class="ml">Fed Funds ëª©í‘œ</div><div class="mv" style="color:var(--accent)" id="m-ff">--</div><div class="ms" id="m-ff-d">FRED ì‹¤ì‹œê°„</div></div>
    <div class="mc"><div class="ml">ë‹¤ìŒ FOMC</div><div class="mv" style="color:var(--orange)" id="m-next">--</div><div class="ms" id="m-next-d">--</div></div>
    <div class="mc"><div class="ml">ì‹œì¥ ì˜ˆìƒ</div><div class="mv" style="color:var(--green)" id="m-exp">--</div><div class="ms" id="m-exp-d">Polymarket</div></div>
  </div>

  <!-- SOFR -->
  <div class="sec">
    <div class="sh"><div class="st">ğŸ“ˆ SOFR ê¸ˆë¦¬ ì¶”ì´ <span class="badge b-nyfed">NY Fed</span><span class="badge b-free">ë¬´ë£Œ</span></div><div class="sd">ë‰´ìš• ì—°ì¤€ ë°œí‘œ Secured Overnight Financing Rate</div></div>
    <div class="cw"><canvas id="cSOFR"></canvas></div>
    <div class="info">
      <div class="it">ğŸ’¡ SOFRì´ë€?</div>
      <b>SOFR</b>(Secured Overnight Financing Rate)ì€ ë¯¸êµ­ êµ­ì±„ë¥¼ ë‹´ë³´ë¡œ í•œ í•˜ë£¨ì§œë¦¬ ëŒ€ì¶œ ê¸ˆë¦¬ë¡œ, ë‰´ìš• ì—°ì¤€ì´ ë§¤ì¼ ë°œí‘œí•©ë‹ˆë‹¤.<br>
      â€¢ <b>Fed ê¸°ì¤€ê¸ˆë¦¬ì˜ ì‹¤ì œ ì‹œì¥ ë°˜ì˜ì¹˜</b> â€” í˜„ì¬ ëª©í‘œ ë²”ìœ„ ì¤‘ í•˜í•œì— ê·¼ì ‘í•˜ê²Œ ê±°ë˜ë©ë‹ˆë‹¤.<br>
      â€¢ SOFR ê¸‰ë“±ì€ ë‹¨ê¸° ìê¸ˆì‹œì¥ ìŠ¤íŠ¸ë ˆìŠ¤ ì‹ í˜¸ì…ë‹ˆë‹¤ (ë¶„ê¸°ë§Â·ì—°ë§ íš¨ê³¼).<br>
      â€¢ 2023ë…„ë¶€í„° LIBORë¥¼ ëŒ€ì²´í•˜ì—¬ ë¯¸êµ­ ê¸ˆìœµì‹œì¥ì˜ <b>í•µì‹¬ ê¸°ì¤€ê¸ˆë¦¬</b>ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- FOMC Bar -->
  <div class="sec">
    <div class="sh"><div class="st">ğŸ¯ FOMC ë¯¸íŒ…ë³„ ê¸ˆë¦¬ ì „ë§ <span class="badge b-poly">Polymarket</span></div><div class="sd">2026 FOMC ê³µì‹ ì¼ì • + Polymarket ì˜ˆì¸¡ í™•ë¥ </div></div>
    <div id="fomcWrap"><div class="cw" style="height:320px"><canvas id="cFOMC"></canvas></div>
    <div class="leg">
      <div class="leg-i"><div class="leg-d" style="background:#64748b"></div>ë™ê²°</div>
      <div class="leg-i"><div class="leg-d" style="background:#3b82f6"></div>25bp ì¸í•˜</div>
      <div class="leg-i"><div class="leg-d" style="background:#06b6d4"></div>50bp+ ì¸í•˜</div>
      <div class="leg-i"><div class="leg-d" style="background:#ef4444"></div>ì¸ìƒ</div>
    </div></div>
  </div>

  <!-- Rate Path -->
  <div class="sec">
    <div class="sh"><div class="st">ğŸ“‰ ì˜ˆìƒ ê¸ˆë¦¬ ê²½ë¡œ <span class="badge b-poly">Polymarket</span><span class="badge b-fred">FRED</span></div><div class="sd">í˜„ì¬ ëª©í‘œê¸ˆë¦¬ + ì˜ˆì¸¡ì‹œì¥ í™•ë¥  â†’ ë‚´ì¬ ê¸ˆë¦¬ ê²½ë¡œ</div></div>
    <div class="cw"><canvas id="cPath"></canvas></div>
    <div class="info">
      <div class="it">ğŸ“ ê³„ì‚° ë°©ë²•</div>
      ê° FOMCì˜ ê¸°ëŒ€ ë³€ë™ = (25bpì¸í•˜ í™•ë¥  Ã— -0.25) + (50bpì¸í•˜ í™•ë¥  Ã— -0.50) + (ì¸ìƒ í™•ë¥  Ã— +0.25)<br>
      FREDì—ì„œ ê°€ì ¸ì˜¨ í˜„ì¬ ëª©í‘œê¸ˆë¦¬ì—ì„œ ëˆ„ì í•˜ì—¬ ê²½ë¡œë¥¼ ì¶”ì •í•©ë‹ˆë‹¤. ì˜ˆì¸¡ ë°ì´í„° ì—†ëŠ” ë¯¸íŒ…ì€ ë™ê²°ë¡œ ê°€ì •í•©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- FOMC Table (all 2026) -->
  <div class="sec">
    <div class="sh"><div class="st">ğŸ“‹ 2026 FOMC ì „ì²´ ì¼ì •</div><div class="sd">ì—°ì¤€ ê³µì‹ ë°œí‘œ ê¸°ì¤€ Â· Polymarket í™•ë¥  ë§¤í•‘</div></div>
    <div style="overflow-x:auto"><table class="ft"><thead><tr><th>ë¯¸íŒ…</th><th>ë‚ ì§œ</th><th>ìƒíƒœ</th><th>ë™ê²°</th><th>25bp ì¸í•˜</th><th>50bp+ ì¸í•˜</th><th>ì¸ìƒ</th></tr></thead><tbody id="tBody"></tbody></table></div>
  </div>

  <div class="foot">
    âš ï¸ ë³¸ ëŒ€ì‹œë³´ë“œëŠ” ì •ë³´ ì œê³µ ëª©ì ì´ë©°, íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹™ë‹ˆë‹¤.<br>
    ë°ì´í„°: NY Fed SOFR Â· FRED Fed Funds Target Â· Polymarket Gamma API (ëª¨ë‘ ë¬´ë£Œ)
  </div>
</div>

<script>
const MO_KO={1:"1ì›”",2:"2ì›”",3:"3ì›”",4:"4ì›”",5:"5ì›”",6:"6ì›”",7:"7ì›”",8:"8ì›”",9:"9ì›”",10:"10ì›”",11:"11ì›”",12:"12ì›”"};
const MO_EN={january:1,february:2,march:3,april:4,may:5,june:6,july:7,august:8,september:9,october:10,november:11,december:12};

function oKo(o){const m={"Yes":"ì˜ˆ","No":"ì•„ë‹ˆì˜¤","No change":"ë™ê²°","25 bps decrease":"25bp ì¸í•˜","25 bps cut":"25bp ì¸í•˜","50 bps decrease":"50bp ì¸í•˜","50 bps cut":"50bp ì¸í•˜","75 bps decrease":"75bp ì¸í•˜","25 bps increase":"25bp ì¸ìƒ","50 bps increase":"50bp ì¸ìƒ","Increase":"ì¸ìƒ","Decrease":"ì¸í•˜"};
if(m[o])return m[o];let r;
if(r=o.match(/(\d+)\s*bps?\s*(decrease|cut)/i))return`${r[1]}bp ì¸í•˜`;
if(r=o.match(/(\d+)\s*bps?\s*(increase|hike)/i))return`${r[1]}bp ì¸ìƒ`;
if(r=o.match(/(\d+\.\d+)\s*[-â€“]\s*(\d+\.\d+)/))return`${r[1]}~${r[2]}%`;
return o;}

// â•â•â•â•â•â•â•â•â•â•â• Data â•â•â•â•â•â•â•â•â•â•â•
async function loadData(){
  try{const r=await fetch("data/rate_data.json");if(r.ok){const j=await r.json();if(j.fomc_calendar?.length)return j;}}catch(_){}
  return {meta:{updated_at:new Date().toISOString()},fomc_calendar:[],sofr:[],fed_funds_target:null,polymarket:[]};
}

// â•â•â•â•â•â•â•â•â•â•â• FOMC Calendar + Polymarket merge â•â•â•â•â•â•â•â•â•â•â•
function buildFOMC(cal, polyEvents){
  const now=new Date(), yr=now.getFullYear();

  // Polymarket â†’ month ì¸ë±ìŠ¤
  const pByMonth={};
  for(const ev of polyEvents){
    const tl=ev.title.toLowerCase();
    let mo=null;
    for(const[en,num]of Object.entries(MO_EN)){if(tl.includes(en)){mo=num;break;}}
    if(!mo)continue;
    // endDateë¡œ ì—°ë„ í™•ì¸
    let eyr=yr;
    if(ev.endDate){try{eyr=new Date(ev.endDate).getFullYear();}catch(_){}}
    if(eyr===yr) pByMonth[mo]=ev;
  }

  const meetings=[];
  for(const c of cal){
    const pev=pByMonth[c.month]||null;
    const endD=new Date(c.end_date+"T23:59:59Z");
    const past=endD<now;
    let nc=0,c25=0,c50=0,hk=0,has=false;

    if(pev){
      has=true;
      for(const m of pev.markets){
        const oc=m.outcomes_en||[];
        oc.forEach((o,i)=>{
          const ol=o.toLowerCase(),p=(m.prices[i]||0)*100;
          if(ol.includes("no change"))nc=Math.max(nc,p);
          else if(ol.includes("25")&&(ol.includes("decrease")||ol.includes("cut")))c25=Math.max(c25,p);
          else if((ol.includes("50")||ol.includes("75")||ol.includes("100"))&&(ol.includes("decrease")||ol.includes("cut")))c50=Math.max(c50,p);
          else if(ol.includes("hike")||ol.includes("increase"))hk=Math.max(hk,p);
        });
        // binary market ì²˜ë¦¬
        if(oc.length===2){
          const q=(m.question_en+" "+m.groupItemTitle_en).toLowerCase();
          const p0=(m.prices[0]||0)*100;
          if(q.includes("no change"))nc=Math.max(nc,p0);
          else if(q.includes("25")&&(q.includes("decrease")||q.includes("cut")))c25=Math.max(c25,p0);
          else if(q.includes("50")&&(q.includes("decrease")||q.includes("cut")))c50=Math.max(c50,p0);
          else if(q.includes("increase")||q.includes("hike"))hk=Math.max(hk,p0);
        }
      }
    }

    const dd=c.date.split("-"), ed=c.end_date.split("-");
    meetings.push({
      title: MO_KO[c.month],
      dateLabel: `${+dd[1]}/${+dd[2]}~${+ed[2]}`,
      fullDate: `${YEAR}ë…„ ${+dd[1]}ì›” ${+dd[2]}~${+ed[2]}ì¼`,
      month: c.month,
      noChange:Math.round(nc), cut25:Math.round(c25), cut50:Math.round(c50), hike:Math.round(hk),
      hasData:has, isPast:past,
    });
  }

  // ìƒíƒœ
  const fi=meetings.findIndex(m=>!m.isPast);
  meetings.forEach((m,i)=>{m.status=m.isPast?"done":i===fi?"next":"future";});
  return meetings;
}

// â•â•â•â•â•â•â•â•â•â•â• Charts â•â•â•â•â•â•â•â•â•â•â•
Chart.defaults.color='#94a3b8';Chart.defaults.borderColor='#1a2332';
Chart.defaults.font.family="'Noto Sans KR','JetBrains Mono',sans-serif";Chart.defaults.font.size=11;
const C={};

function drawSOFR(d){
  if(!d.length)return;
  const ctx=document.getElementById("cSOFR").getContext("2d");
  if(C.s)C.s.destroy();
  C.s=new Chart(ctx,{type:"line",
    data:{labels:d.map(x=>{const t=new Date(x.date);return`${t.getMonth()+1}/${t.getDate()}`}),
      datasets:[{data:d.map(x=>x.rate),borderColor:"#06b6d4",backgroundColor:"rgba(6,182,212,.08)",borderWidth:2,fill:true,tension:.3,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:"#06b6d4"}]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:"index",intersect:false},
      plugins:{legend:{display:false},tooltip:{backgroundColor:"#1e293b",borderColor:"#334155",borderWidth:1,padding:8,callbacks:{label:c=>`SOFR: ${c.raw.toFixed(3)}%`}}},
      scales:{x:{grid:{display:false},ticks:{maxTicksLimit:10,font:{size:10}}},y:{grid:{color:"#1a2332"},ticks:{callback:v=>v.toFixed(2)+"%",font:{size:10}}}}}
  });
}

function drawFOMC(fomc){
  if(!fomc.length)return;
  const ctx=document.getElementById("cFOMC").getContext("2d");
  if(C.f)C.f.destroy();
  // ëª¨ë“  ë¯¸íŒ… í‘œì‹œ (ê³¼ê±° í¬í•¨)
  C.f=new Chart(ctx,{type:"bar",
    data:{labels:fomc.map(m=>{
      let l=m.title;
      if(!m.hasData&&!m.isPast)l+="\n(ëŒ€ê¸°)";
      if(m.isPast)l+="\n(ì™„ë£Œ)";
      return l;
    }),
      datasets:[
        {label:"ë™ê²°",data:fomc.map(m=>m.noChange),backgroundColor:fomc.map(m=>m.isPast?"rgba(71,85,105,.3)":m.hasData?"#475569":"#2a3040"),borderRadius:3,barPercentage:.72},
        {label:"25bp ì¸í•˜",data:fomc.map(m=>m.cut25),backgroundColor:fomc.map(m=>m.isPast?"rgba(59,130,246,.3)":m.hasData?"#3b82f6":"#1e3a5f"),borderRadius:3,barPercentage:.72},
        {label:"50bp+ ì¸í•˜",data:fomc.map(m=>m.cut50),backgroundColor:fomc.map(m=>m.isPast?"rgba(6,182,212,.3)":m.hasData?"#06b6d4":"#0a4a54"),borderRadius:3,barPercentage:.72},
        {label:"ì¸ìƒ",data:fomc.map(m=>m.hike),backgroundColor:fomc.map(m=>m.isPast?"rgba(239,68,68,.3)":m.hasData?"#ef4444":"#5a2020"),borderRadius:3,barPercentage:.72},
      ]},
    options:{responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{backgroundColor:"#1e293b",borderColor:"#334155",borderWidth:1,padding:8,callbacks:{label:c=>c.raw?`${c.dataset.label}: ${c.raw}%`:''}}},
      scales:{x:{stacked:true,grid:{display:false},ticks:{font:{size:10}}},y:{stacked:true,max:100,grid:{color:"#1a2332"},ticks:{callback:v=>v+"%",font:{size:10}}}}}
  });
}

function drawPath(fomc, targetUpper){
  const future=fomc.filter(m=>!m.isPast);
  if(!future.length)return;
  // FRED ëª©í‘œê¸ˆë¦¬ ì‚¬ìš©, ì—†ìœ¼ë©´ 3.75 (fallback)
  let u=targetUpper||3.75;
  const p=[{l:"í˜„ì¬",u,lo:u-.25}];
  for(const m of future){
    const e=m.hasData?(m.cut25*-.25+m.cut50*-.5+m.hike*.25)/100:0;
    u=Math.round((u+e)*100)/100;
    p.push({l:m.title,u,lo:u-.25});
  }
  const ctx=document.getElementById("cPath").getContext("2d");
  if(C.p)C.p.destroy();
  C.p=new Chart(ctx,{type:"line",
    data:{labels:p.map(x=>x.l),
      datasets:[
        {label:"ë‚´ì¬ ê¸ˆë¦¬ ìƒí•œ",data:p.map(x=>x.u),borderColor:"#3b82f6",backgroundColor:"rgba(59,130,246,.06)",borderWidth:2.5,fill:true,tension:.4,pointRadius:5,pointBackgroundColor:"#3b82f6",pointBorderColor:"#0d1117",pointBorderWidth:2},
        {label:"ë‚´ì¬ ê¸ˆë¦¬ í•˜í•œ",data:p.map(x=>x.lo),borderColor:"#8b5cf6",backgroundColor:"rgba(139,92,246,.06)",borderWidth:2,borderDash:[5,5],fill:true,tension:.4,pointRadius:4,pointBackgroundColor:"#8b5cf6",pointBorderColor:"#0d1117",pointBorderWidth:2},
      ]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:"index",intersect:false},
      plugins:{legend:{position:"bottom",labels:{boxWidth:10,padding:14,font:{size:10},usePointStyle:true}},tooltip:{backgroundColor:"#1e293b",borderColor:"#334155",borderWidth:1,padding:8,callbacks:{label:c=>`${c.dataset.label}: ${c.raw.toFixed(2)}%`}}},
      scales:{x:{grid:{display:false},ticks:{font:{size:10}}},y:{grid:{color:"#1a2332"},ticks:{callback:v=>v.toFixed(2)+"%",stepSize:.25,font:{size:10}},suggestedMin:2.0}}}
  });
}

function drawTable(fomc){
  const tb=document.getElementById("tBody");
  if(!fomc.length){tb.innerHTML='<tr><td colspan="7" class="nd">ë°ì´í„° ì—†ìŒ</td></tr>';return;}
  tb.innerHTML=fomc.map(f=>{
    const sc=f.status==="done"?"s-done":f.status==="next"?"s-next":"s-future";
    const sl=f.status==="done"?"ì™„ë£Œ":f.status==="next"?"â–¶ ë‹¤ìŒ":"ì˜ˆì •";
    const rowStyle=f.status==="next"?'style="background:rgba(245,158,11,.04)"':f.isPast?'style="opacity:.5"':'';
    if(!f.hasData&&!f.isPast)
      return`<tr ${rowStyle}><td style="font-weight:600">${f.title}</td><td style="font-size:11px;color:var(--dim)">${f.fullDate}</td><td><span class="sb ${sc}">${sl}</span></td><td colspan="4" style="text-align:center;color:var(--dim);font-size:11px">ì˜ˆì¸¡ ë°ì´í„° ëŒ€ê¸°</td></tr>`;
    const bar=(p,c)=>`<div class="pb"><div class="bar" style="width:${Math.max(p,1)}%;background:${c}"></div><span class="pl" style="color:${c}">${p}%</span></div>`;
    return`<tr ${rowStyle}><td style="font-weight:600">${f.title}</td><td style="font-size:11px;color:var(--dim)">${f.fullDate}</td><td><span class="sb ${sc}">${sl}</span></td><td>${bar(f.noChange,"#64748b")}</td><td>${bar(f.cut25,"#3b82f6")}</td><td>${bar(f.cut50,"#06b6d4")}</td><td>${bar(f.hike,"#ef4444")}</td></tr>`;
  }).join("");
}

// â•â•â•â•â•â•â•â•â•â•â• Metrics â•â•â•â•â•â•â•â•â•â•â•
function updateMetrics(sofr, fomc, data){
  const tgt=data.fed_funds_target;
  // SOFR
  if(sofr.length){
    const l=sofr[sofr.length-1];
    document.getElementById("m-sofr").textContent=l.rate.toFixed(2)+"%";
    document.getElementById("m-sofr-d").textContent=l.date;
  }
  // Fed Funds Target from FRED
  if(tgt && tgt.upper!=null && tgt.lower!=null){
    document.getElementById("m-ff").textContent=`${tgt.lower.toFixed(2)}-${tgt.upper.toFixed(2)}%`;
    document.getElementById("m-ff-d").textContent=`FRED ${tgt.upper_date||''}`;
  } else {
    // SOFRì—ì„œ ì¶”ì •
    if(sofr.length){
      const sr=sofr[sofr.length-1].rate;
      const est_lower=Math.round(sr*4)/4;  // ê°€ì¥ ê°€ê¹Œìš´ 0.25 ë‹¨ìœ„
      const est_upper=est_lower+0.25;
      document.getElementById("m-ff").textContent=`~${est_lower.toFixed(2)}-${est_upper.toFixed(2)}%`;
      document.getElementById("m-ff-d").textContent="SOFR ê¸°ë°˜ ì¶”ì •";
    }
  }
  // Next FOMC
  const next=fomc.find(f=>f.status==="next");
  if(next){
    document.getElementById("m-next").textContent=next.title;
    document.getElementById("m-next-d").textContent=next.fullDate;
  }
  // Market expectation for next
  if(next&&next.hasData){
    const vals=[{l:"ë™ê²°",p:next.noChange},{l:"ì¸í•˜",p:next.cut25+next.cut50},{l:"ì¸ìƒ",p:next.hike}];
    const top=vals.reduce((a,b)=>b.p>a.p?b:a);
    document.getElementById("m-exp").textContent=`${top.l} ${top.p}%`;
    document.getElementById("m-exp-d").textContent=`ë‹¤ìŒ FOMC (${next.title})`;
  } else {
    document.getElementById("m-exp").textContent="ë°ì´í„° ëŒ€ê¸°";
    document.getElementById("m-exp-d").textContent="Polymarket";
  }
  // Timestamp
  const ts=data.meta?.updated_at||new Date().toISOString();
  const d=new Date(ts);
  document.getElementById("ts").textContent=`${d.toLocaleDateString("ko-KR")} ${d.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})} ì—…ë°ì´íŠ¸`;
}

// â•â•â•â•â•â•â•â•â•â•â• Init â•â•â•â•â•â•â•â•â•â•â•
async function init(){
  try{
    const data=await loadData();
    const sofr=data.sofr||[];
    const fomc=buildFOMC(data.fomc_calendar||[], data.polymarket||[]);
    const tgt=data.fed_funds_target;
    const targetUpper=(tgt&&tgt.upper!=null)?tgt.upper:null;
    updateMetrics(sofr,fomc,data);
    drawSOFR(sofr);drawFOMC(fomc);drawPath(fomc,targetUpper);drawTable(fomc);
  }catch(e){console.error(e);document.getElementById("ts").textContent="ë¡œë“œ ì‹¤íŒ¨: "+e.message;}
}
init();
</script>
</body>
</html>
